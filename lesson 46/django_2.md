# Шаблоны в Django

Шаблоны в Django играют важную роль, позволяя разработчикам отделять логику представления данных от HTML-разметки. Это делает код более чистым, удобным для поддержки и модификации. Шаблонизатор Django очень похож на Jinja2, используемый во Flask, и предлагает мощные инструменты для генерации динамического HTML-контента, включая условные операторы, циклы и фильтры. Шаблоны в Django позволяют разработчикам создавать динамические веб-страницы, которые могут адаптироваться под различные данные и условия.

Шаблоны в Django используются для отображения данных на веб-странице. Они содержат HTML-разметку с вставками кода на языке шаблонов Django, который позволяет выполнять операции над данными и контролировать их отображение.

В Django шаблоны обычно разделяются на несколько файлов. Основной шаблон (base template) содержит общую структуру страницы, такую как заголовок, навигационное меню и подвал. В этом шаблоне определены блоки, которые могут быть переопределены в дочерних шаблонах.

Дочерние шаблоны наследуют основной шаблон и могут переопределять блоки, добавлять свои собственные блоки или использовать переменные контекста, переданные из представления (view). Переменные контекста позволяют передавать данные из представления в шаблон для их отображения.

В шаблонах Django можно использовать условные операторы (if-else), циклы (for) и фильтры для управления отображением данных. Фильтры позволяют форматировать данные или применять к ним различные операции.

Шаблоны Django также поддерживают наследование друг от друга, что позволяет создавать иерархию шаблонов и повторно использовать код. Это упрощает разработку и поддержку проекта, так как изменения в одном шаблоне автоматически применяются ко всем его наследникам.

В целом, использование шаблонов в Django помогает разработчикам создавать гибкие и масштабируемые веб-приложения, которые легко поддерживать и модифицировать. Они позволяют отделить логику представления данных от HTML-разметки, что делает код более чистым и понятным.  

### Работа с шаблонами в Django

#### Импортирование инструментов для работы с шаблонами

Для работы с шаблонами в Django необходимо использовать функцию `render`, которая автоматически обрабатывает шаблон и возвращает объект `HttpResponse` с сгенерированным контентом. Функция `render_to_string` также может быть использована для преобразования шаблона в строку, но `render` предпочтительнее, так как она объединяет обе операции и упрощает код.

#### Размещение шаблонов

По умолчанию Django ищет шаблоны в директории `templates` каждого приложения. Рекомендуется создавать в этой папке поддиректорию с именем приложения для избежания конфликтов имен между шаблонами разных приложений.

Структура каталогов может выглядеть так:

```
myapp/
    templates/
        myapp/
            my_template.html
```

#### Создание базового шаблона

Ваш шаблон должен быть файлом HTML. Например, базовый шаблон `my_template.html` может выглядеть следующим образом:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Мой шаблон</title>
</head>
<body>
    <h1>Привет из шаблона!</h1>
</body>
</html>
```

Убедитесь, что файл шаблона сохранён в UTF-8 для корректной обработки символов.

Если вы используете VS Studio Code - можно использовать плагин для подсветки синтаксиса шаблонов Django

***Django Support*** (около 16 тыс. установок)

![[Pasted image 20240214133048.png]]



#### Использование функции `render`

Функция `render` принимает три аргумента: объект `HttpRequest`, путь к шаблону и, необязательно, словарь с контекстом для шаблона. Вот пример представления, использующего `render`:

```python
from django.shortcuts import render

def my_view(request):
    return render(request, 'myapp/my_template.html', {'my_data': 'Это данные для шаблона'})
```

#### Как шаблонизатор ищет шаблоны

Django использует настройку `DIRS` из `TEMPLATES` в файле `settings.py` для определения дополнительных мест поиска шаблонов. По умолчанию он ищет шаблоны в `templates` директориях всех приложений, указанных в `INSTALLED_APPS`, и в любых путях, указанных в `DIRS`.

#### Преимущества использования поддиректорий

Размещение шаблонов в поддиректориях с именем приложения гарантирует, что шаблонизатор сможет корректно найти нужный шаблон, даже если в разных приложениях есть шаблоны с одинаковыми именами. Это также помогает организовать шаблоны по приложениям, делая структуру проекта более понятной.

### Вывод

Использование системы шаблонов в Django облегчает разработку веб-приложений, позволяя разрабатывать веб-страницы с динамическим контентом на основе данных приложения. Разделение логики приложения и представления с помощью шаблонов делает код более чистым и удобным для поддержки.

## Где живут шаблоны?

Добавление шаблона и соответствующего представления для страницы "О сайте" (about) является типичной задачей при разработке веб-приложений на Django. В этом процессе вы узнаете, как создать шаблон, связать его с представлением и настроить Django для работы с шаблонами.

### Шаг 1: Создание представления `about`

Для начала создадим представление `about` в файле `views.py` вашего приложения:

```python
from django.shortcuts import render

def about(request):
    return render(request, 'about.html')
```

Это представление использует функцию `render` для генерации HTML-страницы на основе шаблона `about.html`.

### Шаг 2: Создание шаблона `about.html`

Создайте файл шаблона `about.html` в директории `templates` вашего приложения. Если у вас есть структура с поддиректориями для каждого приложения внутри `templates`, поместите `about.html` в соответствующую поддиректорию. Вот простой пример содержимого шаблона:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>О сайте</title>
</head>
<body>
    <h1>О сайте</h1>
    <p>Это страница описывает наш сайт.</p>
</body>
</html>
```

### Шаг 3: Настройка URL для представления `about`

Теперь необходимо добавить URL-маршрут в `urls.py`, чтобы Django знал, как перенаправлять запросы на ваше представление `about`:

```python
from django.urls import path
from .views import about

urlpatterns = [
    path('about/', about, name='about'),
]
```

### Конфигурация шаблонов в Django

Конфигурация шаблонов в Django определяется в настройке `TEMPLATES` файла `settings.py`. Эта "коллекция" содержит словари конфигурации для каждого шаблонизатора, которые вы используете в проекте. В большинстве случаев используется стандартный шаблонизатор Django. 

Пример стандартной конфигурации:

```python
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
        'APP_DIRS': True,
        'OPTIONS': {
            # ... другие опции
        },
    },
]
```

- **`BACKEND`**: Указывает на использование стандартного шаблонизатора Django.
- **`DIRS`**: Список директорий, в которых шаблонизатор будет искать шаблоны. Это позволяет указать пути к шаблонам, не привязанным к конкретному приложению.
- **`APP_DIRS`**: При установке в `True`, Django будет искать шаблоны в директориях `templates` каждого установленного приложения. Благодаря этому параметру шаблон `about.html` будет успешно найден, если он расположен в стандартной директории приложения.

### Тестирование

После настройки представления, шаблона и URL, запустите сервер разработки Django:

```bash
python manage.py runserver
```

Теперь вы можете перейти по адресу `http://127.0.0.1:8000/about/`, чтобы увидеть вашу новую страницу "О сайте".

### Вывод

Использование шаблонов в Django позволяет разрабатывать веб-страницы более гибко и эффективно, отделяя HTML-разметку от Python-кода в представлениях. Настройка `TEMPLATES` в `settings.py` управляет поиском и обработкой шаблонов, обеспечивая гибкость и мощные возможности для работы с динамическим контентом.


## Передача данных в шаблон

Шаблон в контексте веб-разработки — это файл, содержащий статический текст (часто HTML), в который могут быть вставлены динамические элементы. Эти динамические элементы обозначаются специальными конструкциями (например, `{{ variable_name }}` в Django), которые при обработке шаблона заменяются на соответствующие значения. Это позволяет генерировать пользовательский контент на основе данных приложения.

### Пример использования шаблонов в Django

В Django шаблоны используются вместе с представлениями для генерации HTML-ответов, отправляемых пользователю. Давайте рассмотрим пример представления, которое передает данные в шаблон:

```python
from django.shortcuts import render

def my_view(request):
    context = {
        'title': 'Мой сайт',
        'menu': ['О сайте', 'Добавить', 'Карточку', 'Обратная связь', 'Войти'],
        'data': {
            'int_number': 5,
            'float_number': 3.14,
            'my_object': {'a': 1, 'b': 2},
            # другие данные...
        }
    }
    return render(request, 'my_template.html', context)
```

В этом примере `context` — это словарь, содержащий данные, которые мы хотим отобразить в шаблоне. В шаблоне `my_template.html` мы можем использовать эти данные следующим образом:

```django
<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
</head>
<body>
    <h1>{{ title }}</h1>
    <ul>
        {% for item in menu %}
            <li>{{ item }}</li>
        {% endfor %}
    </ul>

    <!-- Доступ к элементам словаря -->
    <p>Целое число: {{ data.int_number }}</p>
    <p>Дробное число: {{ data.float_number }}</p>
    <p>Объект: a = {{ data.my_object.a }}, b = {{ data.my_object.b }}</p>
</body>
</html>
```

### Особенности работы с шаблонами в Django

- **Передача параметров**: Для передачи данных в шаблон используется контекст — словарь, где ключи доступны в шаблоне как переменные.
- **Итерация по спискам**: В шаблонах Django можно итерировать по спискам с помощью тега `{% for %}`.
- **Доступ к данным**: Доступ к *элементам словаря* и *атрибутам объектов* в шаблоне осуществляется через точку (например, `{{ data.my_object.a }}`).

### Как обращаться к ключу словаря и объекту класса?

В шаблонах Django доступ к атрибутам объекта или ключам словаря производится через точку, как показано в предыдущем примере. Это унифицированный способ обращения к данным, что упрощает работу с шаблонами.

### Вывод

Шаблоны в Django позволяют разработчикам эффективно генерировать динамические веб-страницы, используя данные приложения. Система шаблонов предлагает мощные инструменты для работы с данными, включая итерацию, условия и фильтры, делая код представления чистым и организованным. Важно помнить, что шаблоны должны использоваться для отображения данных, а всю логику обработки следует оставлять в представлениях или других частях приложения.


## Фильтры шаблонов в Django

Фильтры шаблонов в Django используются для модификации переменных перед их отображением в шаблоне. Они могут изменять формат вывода, применять текстовые преобразования, работать с датами и временем, числами и списками, и так далее. Фильтры указываются в шаблоне через символ `|`.

### Основные стандартные фильтры:

- **`capfirst`**: Делает первую букву строки заглавной.
    ```django
  {{ value|capfirst }}
  ```
- **`upper`**: Преобразует все символы строки в верхний регистр.
  ```django
  {{ value|upper }}
  ```
- **`lower`**: Преобразует все символы строки в нижний регистр.
    ```django
  {{ value|lower }}
  ```
- **`cut`**: Удаляет все вхождения указанной подстроки из строки.
    ```django
  {{ value|cut:" " }}
  ```
  Удаляет все пробелы из `value`.
- **Цепочка фильтров**: Фильтры могут быть соединены в цепочки, применяясь последовательно.
  ```django
  {{ value|cut:" "|capfirst }}
  ```
  Сначала удаляет все пробелы, затем делает первую букву заглавной.

- **`default`**: Подставляет значение по умолчанию, если переменная пуста.
  ```django
  {{ value|default:"Пусто" }}
  ```
  
- **`first`** и **`last`**: Возвращают первый или последний элемент списка соответственно.
  ```django
  {{ values|first }}
  {{ values|last }}
  ```
  
- **`join`**: Объединяет список в строку, используя указанный разделитель.
  ```django
  {{ values|join:" | " }}
  ```
  Объединяет элементы списка `values`, используя `|` в качестве разделителя.

- **`length`**: Возвращает длину списка или строки.
  ```django
  {{ value|length }}
  ```
  
- **`slugify`**: Преобразует строку в "слаг", удобный для использования в URL.
  ```django
  {{ value|slugify }}
  ```

### Импортирование фильтров в Python

Хотя фильтры шаблонов предназначены для использования в шаблонах Django, некоторые из них доступны и в коде Python. Они находятся в модуле `django.template.defaultfilters`. Например, чтобы использовать фильтр `slugify` в Python коде:

```python
from django.template.defaultfilters import slugify

text = "Пример текста для URL"
slug = slugify(text)
```

### Вывод

Фильтры шаблонов Django предоставляют мощный инструмент для обработки и форматирования данных перед их отображением. Использование фильтров делает шаблоны более читаемыми и позволяет разработчикам легко применять сложные текстовые преобразования прямо в шаблоне, без необходимости добавления дополнительной логики в представления или контекст.


## Циклы и условия в шаблонах

Теги шаблонов в Django – это специальные блоки, заключённые в `{%` и `%}`, которые выполняют определённые функции в шаблонах, такие как циклы, условные операторы и комментарии. Они делают шаблоны более динамичными и позволяют вам контролировать, как и что отображается на странице.

### Комментарии в шаблонах

Да, в шаблонах Django можно оставлять комментарии, которые не будут отображаться в итоговом HTML. Синтаксис комментариев следующий:

```django
{# Это комментарий #}
```

Комментарии могут занимать целую строку или быть вставлены в строку кода.

### Тег `for`

Тег `for` используется для итерации по элементам списка. Синтаксис следующий:

```django
{% for item in list %}
    {{ item }}
{% endfor %}
```

Всё, что находится между `{% for %}` и `{% endfor %}`, будет повторено для каждого элемента в списке.

### Теги `if`, `elif`, `else`, `endif`

Эти теги используются для выполнения условных проверок:

```django
{% if condition %}
    ...
{% elif other_condition %}
    ...
{% else %}
    ...
{% endif %}
```

### Пример использования тегов `for` и `if`

Представьте, что у вас есть список словарей постов, которые вы хотите отобразить:

```python
posts = [
    {'title': 'Первый пост', 'content': 'Контент первого поста', 'is_published': True},
    {'title': 'Второй пост', 'content': 'Контент второго поста', 'is_published': False},
    # и так далее...
]
```

Передайте этот список в шаблон через контекст:

```python
return render(request, 'my_template.html', {'posts': posts})
```

В шаблоне используйте тег `for` для итерации по постам и тег `if` для проверки условия:

```django
<ul>
{% for post in posts %}
    {% if post.is_published %}
        <li>
            <h2>{{ post.title }}</h2>
            <p>{{ post.content }}</p>
            {% if not forloop.last %}<hr>{% endif %}
        </li>
    {% endif %}
{% endfor %}
</ul>
```

`forloop.last` является специальной переменной в шаблонизаторе Django, которая в контексте цикла `for` указывает, что текущая итерация является последней. Это полезно, когда вам нужно применить особое поведение или стилизацию для последнего элемента в последовательности.

### Как работает `forloop.last`:

Внутри цикла `{% for %}` в шаблонах Django, `forloop` — это объект, который содержит информацию о текущей итерации цикла. `forloop.last` — это булево значение (`True` или `False`), которое становится `True`, если цикл достиг последнего элемента последовательности.

### Обработка на сервере vs обработка на клиенте

Теги шаблонов обрабатываются на сервере, когда Django генерирует HTML-страницу. Это означает, что логика тегов шаблонов (циклы, условные операторы и т.д.) выполняется до того, как страница будет отправлена в браузер пользователя. HTML-теги, с другой стороны, обрабатываются на стороне клиента (в браузере), и определяют структуру и стилизацию отображаемого контента.

Теги шаблонов делают систему шаблонов Django мощным инструментом для динамического создания веб-страниц, позволяя разработчикам легко интегрировать данные и логику приложения с пользовательским интерфейсом.

#таблица 

| Атрибут               | Описание                                                                                  |
| --------------------- | ----------------------------------------------------------------------------------------- |
| `forloop.counter`     | Порядковый номер текущей итерации цикла, начиная с 1.                                     |
| `forloop.counter0`    | Порядковый номер текущей итерации цикла, начиная с 0.                                     |
| `forloop.revcounter`  | Количество оставшихся итераций цикла, включая текущую, начиная с общего числа элементов.  |
| `forloop.revcounter0` | Количество оставшихся итераций цикла, не включая текущую, начиная с общего числа минус 1. |
| `forloop.first`       | Возвращает `True`, если текущая итерация является первой.                                 |
| `forloop.last`        | Возвращает `True`, если текущая итерация является последней.                              |
| `forloop.parentloop`  | Для вложенных циклов, это ссылка на `forloop` внешнего цикла.                             |